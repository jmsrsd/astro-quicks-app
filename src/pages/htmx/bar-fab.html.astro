---
import { useSearchParams } from "../../utils/searchParams";
import ActionFAB from "./fab-action.html.astro";
import InboxFAB from "./fab-inbox.html.astro";
import TaskFAB from "./fab-task.html.astro";

const { props, url } = Astro;

const [searchParams] = useSearchParams({ url });

for (const key of [...Object.keys(props), ...Object.keys(searchParams)]) {
  props[key] = searchParams[key] ?? props[key];
}

const opened = props.opened === "true";

const openedStyle = {
  display: opened ? undefined : "none",
};
---

<div
  id="htmx-bar-fab"
  class="tw-absolute tw-right-[34px] tw-bottom-[27px] tw-flex tw-flex-row-reverse tw-items-center tw-justify-end tw-gap-[26px] tw-duration-300 tw-overflow-x-hidden"
  hx-get={`/htmx/bar-fab.html?opened=${!opened}`}
  hx-swap="outerHTML swap:300ms"
  hx-trigger={`${opened ? `mouseleave` : `mouseenter`} once`}
  hx-target="#htmx-bar-fab"
>
  <style is:inline>
    #htmx-bar-fab.htmx-swapping > *:not(#htmx-bar-fab-action) {
      transform: translate(150%);
      opacity: 0;
    }

    #htmx-bar-fab.htmx-added > *:not(#htmx-bar-fab-action) {
      transform: translate(150%);
      opacity: 0;
    }

    #htmx-bar-fab > *:not(#htmx-bar-fab-action) {
      transform: translate(0%);
      opacity: 1;
      transition: all 300ms ease;
    }
  </style>
  <ActionFAB id="htmx-bar-fab-action" />
  <InboxFAB style={openedStyle} />
  <TaskFAB style={openedStyle} />
</div>
